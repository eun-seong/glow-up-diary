---
date: 2024-02-06
today:
---
## 알고리즘
- [BOJ - 17144](https://www.acmicpc.net/problem/17144): 빡구현, 시계 방향 반시계 방향으로 순회하는 것을 dx, dy를 그 순서에 맞게 direct 배열을 만들어서 사용할 수 있다. 일일이 하나씩 안해도 되었었던 것..
- [BOJ - 9935](https://www.acmicpc.net/problem/9935) : 스택 이용

---

## 소셜로그인한 사용자와 회원가입한 사용자를 어떻게 구분할 수 있을까?

### As-is
- 소셜로그인한 사용자 : userId가 있음
- 회원가입한 사용자 : signedUpAt이 null이 아님 (소셜로그인을 완료한 후, 이용약관 동의&프로필 생성을 마친 사용자)

현재는 소셜로그인을 하면 바로 User DB에 저장한다.
회원가입 여부 API를 사용할 수 있다.

현재 문제가 되는 부분 : 회원가입한 사람만 api에 접근할 수 있어야 하는데, 현재 그 장치가 안되어 있다.
- Service에서 요청이 들어올 때마다 가입 여부를 확인하는 것은 DB 입장에서 너무나 비효율적이다.
- 토큰에 담아서 그걸 사용하기에는 중요한 정보라 위험이 있다.
- 애초에 이렇게 확인해야 하는 것이 설계가 잘못되어서 그런 거 아닐까? 앱에서 그걸 확인하는 게 아니라 애초에 회원가입이라는 것 자체가 토큰이 존재하면 참이어야 하는 것 아닌가..?

그럼 해결하려면
- 회원가입이 완료되었다고 판단하는 시점에 DB에 저장해야 한다.
- 프로필 완료까지 회원가입으로 보는 것은 과하다.

엇... 그런데 리서칭하다가 이용약관 대행 기능이 새로 생겼다는 것을 알게됐다😂
문제가 간단해졌다. 동의가 필요한 약관들은 OAuth Provider쪽으로 모두 넘기고, 소셜로그인만 완료하면 회원가입 완료라고 볼 수 있다.
~~하지만 이런 기능 애플은 제공되지 않지~~

### To-be

- 애플 제외 OAuth
	- 회원가입 완료한 사용자 : 소셜로그인 완료 & 이용약관 동의 완료 -> DB 저장
- 애플
	- 로그인 완료 후 apple access token을 클라이언트로 응답
	- 이용약관 동의 페이지에서 동의 api 호출 - apple access token과 함께 요청
	- access token으로 id_token 가져와서 DB에 저장


아 아니야. 관심 악기 설정은 서비스 기획상 꼭 필요한 부분이다. 포기할 수 없다.

간이 프로필 완성까지 회원가입 완료로 봐야 한다.

### 결론
회원가입 완료 기준 : (유지) 소셜 로그인 & 이용약관 동의 & 간이 프로필 완성

1. OAuth 로그인 완료 시
	해당 OAuth token의 accessToken을 응답으로 클라이언트에 보내준다.
2. 이용약관 동의(애플의 경우)와 간이 프로필 완성 후 signup API를 호출한다.
	1번에서 보내준 OAuth accessToken과 함께 요청한다.
3. accessToken으로 회원정보 조회
	2번의 요청에서 id를 가져와서 간이 프로필과 함께 DB에 저장한다.

이렇게 되면 security에서 oauth 기능을 사용하지 않게 될 수도 있겠다.
애플 로그인 과정을 한 번 테스트해봐야 정확히 알 수 있겠다.

